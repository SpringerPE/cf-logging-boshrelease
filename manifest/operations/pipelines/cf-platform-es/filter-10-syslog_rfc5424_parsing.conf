filter {
    # Parse RFC5424 syslog messages
    grok {
      break_on_match => true
      match => {
        "@message" => [
          "%{SYSLOG5424LINE}",
          "%{SYSLOG5424BASE}"
          ]
        }
    }

    mutate {
      remove_field => [ "message", "host" ]
      add_tag => [ "syslog5424" ]
    }

    mutate {
      # Use a friendlier naming scheme
      rename => {
        "syslog5424_app"  => "program"
        "syslog5424_msg" => "message"
        "syslog5424_host" => "host"
        "syslog5424_pri" => "priority"
      }
      remove_field => [ "syslog5424_ver", "syslog5424_proc" ]
    }

    # Parsing structured data being part of the syslog message.
    # Example: "[instance@47450 director="" deployment="cf" group="api" az="z1" id="9b5c1d3c-a2fe-45b0-906e-fa88af93fd4a"]"
    if [syslog5424_sd] {
      kv {
        # Convert the structured data into fields
        source => "syslog5424_sd"
        prefix => "sd_"
        remove_field => [ "syslog5424_sd" ]
        trim_key => "\["
        trim_value => "\]"
      }
    }
    date {
      match => [ "syslog5424_ts", "ISO8601" ]
      remove_field => [ "syslog5424_ts", "timestamp" ]
    }
}
