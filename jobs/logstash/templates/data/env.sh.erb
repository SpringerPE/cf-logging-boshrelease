#!/usr/bin/env bash

export TLS_KEY="/var/vcap/jobs/logstash/config/tls.key"
export TLS_CRT="/var/vcap/jobs/logstash/config/tls.crt"
export ES_HOSTS=$(cat /var/vcap/jobs/logstash/config/elasticsearch-hosts)

export JVM_HEAP_SIZE=$((( $( cat /proc/meminfo | grep MemTotal | awk '{ print $2 }' ) * <%= p("logstash.jvm.heap_size_pct") %> ) / 100 / 1024 ))m
<% if_p('logstash.heap_size') do |heap_size| %>
export JVM_HEAP_SIZE=<%= heap_size %>
<% end %>

# job template binding variables
<% if_p("logstash.env") do |environment| %>
<% environment.each do |key, value| %>
export <%= key %>="<%= value %>"
<% end %>
<% end %>

