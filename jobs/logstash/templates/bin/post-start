#!/usr/bin/env bash
set -e # exit immediately if a simple command exits with a non-zero status

export max_attempts=120
export attempts=0
export lostash_status=0

while [[ "$max_attempts" -ge "$attempts" ]]; do
		export logstash_status=$(curl --write-out %{http_code} --silent --output /dev/null --head 'localhost:9600/?pretty')

		if [ $logstash_status -gt 1 ]
		then 
			echo "Logstash response status: $logstash_status"
			exit 0
		fi

    attempts=$(($attempts + 1))

		echo "Attempt #$attempts"

    sleep "1"
done

echo "Logstash failed. Response status: $logstash_status"
exit 1
